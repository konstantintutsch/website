---
layout: post
image: 
title: Clean HTML builds from Jekyll
description: How to get a cleaner HTML output from Jekyll with sed and RegEx
tags: Blog
time: 15:13:49 +0100
---

{% include heading.html level=3 text="Jekyll's default output" %}

The HTML that is generated by Jekyll is normally extremly ugly.

This isn't really a problem. But it is damn annoying 😒

{% include image.html file="jekyll-default-html.webp" alt="A screenshot of my website's HTML without any modifications" caption="This is how my site's HTML looks by default" %}

{% include heading.html level=3 text="Clean HTML" %}

I was using [TidyHTML](https://www.html-tidy.org/). But it messed with my RSS feed. Some bad line breaks and missing spaces occured.

This is why I am now using `sed` with a few regular expressions instead.

```
-e '/^[[:space:]]*$/d'
```

*This snippet removes empty lines*

```
-e 's/\t\+</</g'
-e 's/\ \ \+</</g'
```

*These expressions remove indentation if it is in front of a `<` to not impact `<code>` tags.*

If you want your code blocks to have empty lines though, write the Markdown for your next post like this:

```
´´´
#!/bin/bash
´´´
´´´
echo "This looks like line 3 on the web."
´´´
```

{% include image.html file="jekyll-clean-html.webp" alt="a screenshot of this website's HTML tidied up with sed" caption="Jekyll's output after sed" %}

To automate executing `sed`, create `./_development/deploy.sh`.

You can put the script anywhere you like, but the filepath has to have an underscore as it's first character so that Jekyll ignores it.

```
#!/bin/bash
```
```
JEKYLL_ENV=production jekyll build
```
```
cd "./_site"
```
```
for EXTENSION in "html" "xml"
do
    echo "Extension “${EXTENSION}” …"
    eval "find . -name \"*.${EXTENSION}\" -exec sed -i -e '/^[[:space:]]*$/d' -e 's/\t\+</</g' -e 's/\ \ \+</</g' {} \;"
done
```
```
sshfs -o reconnect,password_stdin ${YOURUSER}@${SERVER}:/${WEBROOT} ${MOUNT} <<< "${PASSWORD}"
rsync -rvz --progress --delete ./ ${MOUNT}
umount ${MOUNT}
```
```
if [[ "${PWD##*/}" == "_site" ]]
then 
    cd ..
fi
```

Now, you probably also want to run this script on every deploy.

You can create a simple git hook (`.git/hooks/pre-push`) to accomplish that.

```
#!/bin/bash
```
```
YOURUSER=…
SERVER=…
WEBROOT=…
MOUNT=…
PASSWORD=…
```
```
./_development/deploy.sh
```

Finally, ensure that the hook is executable:

```
chmod +x ./.git/hooks/pre-push
```

<h4>Done</h4>

You're good to go! Have fun not being annoyed by Jekyll's HTML output 😁
